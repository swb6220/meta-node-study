<center>

# NFT拍卖市场系统说明书

</center>

# 一、概述
本文档说明NFT拍卖市场系统的功能设计实现、部署及测试。

# 二、功能描述
· 普通用户首通过主链NFT合约，铸造自己的NFT，然后在主链拍卖合约上添加拍卖信息，包括起拍价、拍卖开始时间、拍卖持续时间等，对其NFT进行拍卖。  
· 其他普通用户可以通过拍卖合约，使用ETH或者ERC20代币，对拍卖进行出价竞拍。
· 其他普通用户，也可以在从链上，使用ETH或者ERC20代码，对拍卖进行跨链竞拍。  
· 在到达拍卖结束时间之后，主链拍卖合约创建者，可以通过主链拍卖合约，结束竞拍，此时，拍卖者将获得最高竞价，同时，最高竞价者将获得所拍NFT。  
· 主链合约创建者，需要将从链信息，包括chain selector和从链拍卖合约地址，及支持的ERC20代币地址添加到主链合约，然后其他用户才可以使用拍卖功能。

## 1、NFT合约
主要提供NFT的功能：
* 铸造NFT  
```
function mintNFT() public returns (uint256 tokenId)
```
用户铸造NFT，自己的钱包地址，返回tokenId。
* 转移NFT  
用户可以将自己的NFT转移给其他用户，提供自己的钱包地址、接收者的钱包地址、要转移的tokenId。  
* 授权  
用户可以将自己的tokenId授权给其他用户，提供自己的钱包地址、接收者的钱包地址、要授权的tokenId。

## 2、主链拍卖合约
主要提供拍卖功能：
* 创建拍卖  
```
function addAuction(uint256 _tokenId, uint256 _startPrice, uint256 _startTime, uint256 _duration) public returns (uint256 _auctionId)
```
用户创建拍卖对自己的NFT进行拍卖，提供自己的钱包地址、NFT地址、NFT名称、tokenId、起拍价格、起拍时间、拍卖持续时间，返回auctionId。
* 查看拍卖  
```
function getAuction(uint256 _auctionId) public view returns(Auction memory)
```
用户根据auctionId查看拍卖信息，提供auctionId，返回拍卖信息。
* 出价竞拍
```
function bid(uint256 _tokenAmount, address _bidder, uint256 _auctionId, string memory _tokenName) public payable
```

* 结束竞拍
```
function endAuction(uint256 _auctionId) public onlyOwner
```

* 添加Token和Price Feed
```
function registerTokenAndPriceFeed(string memory _tokenName, address _priceFeedAddress, address _tokenAddress) public onlyOwner
```

* 添加从链chain selector和地址
```
function setAuctionSlaves(uint64 _chainSelector, address _slaveAddress) public onlyOwner
```



## 3、从链拍卖合约

* 跨链竞价  
```
function bid(address auctionMaster, uint256 auctionId, uint256 amount, address tokenAddr, string memory tokenName) public payable returns (bytes32 messageId)
```
用户对NFT进行出价竞拍，提供自己的钱包地址、竞拍价格、auctionId。  
用户可以使用ERC20代币或者ETH进行竞价，统一转换为USD进行价格比对。


# 三、部署

* 执行命令，部署主链合约  
```
npx hardhat deploy --tags master --network sepolia
```

* 执行命令，部署从链合约  
```
npx hardhat deploy --tags slave --network amoy 
```

# 四、测试
* 执行命令，运行测试脚本  
```
npx hardhat test .\test\nft_auction_cross_chain_test.js
```




